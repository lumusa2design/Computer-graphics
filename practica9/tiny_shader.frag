#ifdef GL_ES
precision mediump float;
#endif
uniform vec2 u_resolution;uniform float u_time;float h(vec2 p){return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453123);}float n(vec2 p){vec2 i=floor(p),f=fract(p);float a=h(i);float b=h(i+vec2(1.,0.));float c=h(i+vec2(0.,1.));float d=h(i+vec2(1.,1.));vec2 u=f*f*(3.-2.*f);return mix(a,b,u.x)+(c-a)*u.y*(1.-u.x)+(d-b)*u.x*u.y;}float f(vec2 p){float v=0.,a=.5;mat2 M=mat2(1.6,1.2,-1.2,1.6);for(int i=0;i<5;i++){v+=a*n(p);p=M*p;a*=.5;}return v;}vec3 P(float t){vec3 a=vec3(.905,.081,.107);vec3 b=vec3(.85,.768,.059);vec3 c=vec3(.848,.745,.9);vec3 d=vec3(.67,.328,.118);return a+b*cos(6.2831*(c*t+d));}vec2 R(vec2 p,float a){float s=sin(a),c=cos(a);return mat2(c,-s,s,c)*p;}vec3 M(vec2 uv,float t,float S,float rs,float hs,float rf){float r=length(uv),ang=atan(uv.y,uv.x);float w=6.28318/S;ang=abs(mod(ang,w)-.5*w);vec2 p=vec2(ang*rs,r*3.);float f1=f(p+vec2(0.,t));float f2=f(p*2.-vec2(t*1.3,t*.7));vec2 pw=p+.94*vec2(f1,f2);float f3=f(pw+vec2(t*.8,-t*.6));float m=smoothstep(-.18,.9,f1+f2-r*1.85);float rings=sin(rf*r+f3*6.);float pat=mix(f3,rings,.6);pat=.5+.5*pat;float hue=pat+1.3*r+.06*f2+hs;vec3 cR=P(hue+.015),cG=P(hue),cB=P(hue-.015);vec3 col=vec3(cR.r,cG.g,cB.b);col*=(.3+1.6*m);float edge=smoothstep(.4,0.,abs(rings))*m;col+=vec3(.7,.8,1.)*edge*.25;float e=.01;float h0=f3;float hx=f(pw+vec2(e,0.)+vec2(t*.8,-t*.6));float hy=f(pw+vec2(0.,e)+vec2(t*.8,-t*.6));vec3 nrm=normalize(vec3(hx-h0,hy-h0,.5));float la=u_time*.35;vec3 L=normalize(vec3(cos(la),sin(la),.7));float diff=clamp(dot(nrm,L),0.,1.);float spec=pow(max(dot(reflect(-L,nrm),vec3(0,0,1)),0.),10.);col*=(.55+.7*diff);col+=vec3(1.2,1.1,1.3)*spec*.25;return col;}void main(){vec2 uv=(gl_FragCoord.xy-.5*u_resolution.xy)/u_resolution.y;float t=u_time*.25;float r=length(uv);float z=1.+.07*sin(u_time*.4);uv*=z;uv=R(uv,.12*sin(u_time*.2));float sw=.22*sin(4.*r-u_time*.7);uv=R(uv,sw);float bg=f(uv*1.6+vec2(.2*u_time,-.15*u_time));bg=.5+.5*bg;vec3 col=mix(vec3(.01,0.,.03),vec3(.08,0.,.14),bg);float s=n(uv*38.+vec2(8.,-4.));float st=pow(max(0.,1.-fract(s*23.)),22.);col+=vec3(.8,.8,1.)*st*.35;float S=mix(10.,18.,.5+.5*sin(u_time*.3));vec3 l2=M(uv*.85,t+4.,S*.5+6.,3.,.3,5.);vec3 l1=M(uv*1.25,t,S,2.5,0.,8.);col+=l2*.65+l1;float g=exp(-r*4.)*(.4+.4*sin(u_time*1.3));col+=vec3(1.2,1.,1.4)*g*.55;float o=smoothstep(.7,.95,r)*(1.-smoothstep(.95,1.15,r));col+=vec3(.3,.5,1.)*o*.35;float v=smoothstep(1.15,.1,r);col*=v;col=clamp(col,0.,1.2);gl_FragColor=vec4(col,1.);}